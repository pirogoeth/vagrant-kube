# vim: set ai et ts=2 sts=2 sw=2 syntax=yaml:

---
:config:

  hostmanager:
    :enabled: true
    :manage_host: true
    :manage_guest: true
    :ignore_private_ip: true
    :include_offline: false

:groups:

  base:
    :vm:
      :box: failfish/centos72
    :provisioners:
      - :engine: :hostmanager
        :name: cluster-hosts
      - :engine: :shell
        :name: rewrite-hosts
        :options:
          :path: scripts/rewrite-hosts.sh

  kubernetes:
    :provisioners:
      - :engine: :shell
        :name: bootstrap-godev
        :options:
          :path: scripts/gimme-install.sh
          :env:
            GO_VERSION: "1.7.3"
      - :engine: :shell
        :name: bootstrap-kubeadm
        :options:
          :path: scripts/kubernetes-bootstrap.sh

  kube-master:
    :provisioners:
      - :engine: :shell
        :name: bootstrap-external-etcd
        :options:
          :path: scripts/etcd-bootstrap.sh
          :env:
            GO_VERSION: "1.7.3"
            ETCD_ROLE: "master"
      - :engine: :shell
        :name: launch-kube-controller
        :options:
          :path: scripts/kube-control-launch.sh
    :providers:
      - :engine: libvirt
        :options:
          :uri: "qemu+unix:///system"
          :cpu_model: kvm64
          :memory: 1024
          :management_network_mode: route

  kubelet:
    :provisioners:
      - :engine: :shell
        :name: bootstrap-external-etcd
        :options:
          :path: scripts/etcd-bootstrap.sh
          :env:
            GO_VERSION: "1.7.3"
            ETCD_ROLE: "user"
      - :engine: :shell
        :name: launch-kubelet
        :options:
          :path: scripts/kubelet-launch.sh
    :providers:
      - :engine: libvirt
        :options:
          :uri: "qemu+unix:///system"
          :cpu_model: kvm64
          :memory: 4096
          :management_network_mode: route

:machines:

  - :name: kube-master
    :vm:
      :hostname: master.kube.dev
    :networks:
      - :network_type: public_network
        :ip: 10.0.1.50
        :mode: bridge
        :dev: enp4s0f1
    :groups:
      - base
      - kubernetes
      - kube-master

  - :name: kube-n01
    :vm:
      :hostname: n01.kube.dev
    :networks:
      - :network_type: public_network
        :ip: 10.0.1.51
        :mode: bridge
        :dev: enp4s0f1
    :groups:
      - base
      - kubernetes
      - kubelet

  - :name: kube-n02
    :vm:
      :hostname: n02.kube.dev
    :networks:
      - :network_type: public_network
        :ip: 10.0.1.52
        :mode: bridge
        :dev: enp4s0f1
    :groups:
      - base
      - kubernetes
      - kubelet
